{% extends "layout.html" %}
{% if page_title %}{{ page_title }}{% endif %}
{% block content %}
<main class="main">
<div class="container-fluid pt-5">
    <div class="row px-xl-5">
        <!-- ستون اصلی محصولات -->
        <div class="col-lg-12">
            <!-- نوار مرتب‌سازی -->
            <div class="d-flex justify-content-between align-items-center border-bottom mb-4 pb-3">
                <h4 class="font-weight-semi-bold m-0">فروشگاه</h4>
                <div class="dropdown ml-4">
                    <button class="btn border dropdown-toggle" type="button" id="triggerId" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        مرتب‌سازی بر اساس
                    </button>
                    <div class="dropdown-menu dropdown-menu-right" aria-labelledby="triggerId">
                        <a class="dropdown-item {% if current_sort == 'newest' %}active{% endif %}" href="{{ url_for('main.shop', sort='newest') }}">جدیدترین</a>
                        <a class="dropdown-item {% if current_sort == 'price_asc' %}active{% endif %}" href="{{ url_for('main.shop', sort='price_asc') }}">ارزان‌ترین</a>
                        <a class="dropdown-item {% if current_sort == 'price_desc' %}active{% endif %}" href="{{ url_for('main.shop', sort='price_desc') }}">گران‌ترین</a>
                    </div>
                </div>
            </div>

            <!-- گرید محصولات -->
            <div class="row pb-3">
                {% for product in products %}
                <div class="col-lg-3 col-md-4 col-sm-6 pb-1">
                    <!-- ما از همان کارت محصول زیبای پرفروش‌ترین‌ها دوباره استفاده می‌کنیم -->
                    <div class="product-card-v3">
                        <div class="product-image-wrapper-v3">
                            <a href="{{ url_for('main.product_detail', product_id=product.id) }}">
                                <img src="{{ url_for('admin.static', filename='uploads/' + product.image_file) }}" alt="{{ product.name }}">
                            </a>
                        </div>
                        <div class="product-details-v3">
                            <a href="{{ url_for('main.product_detail', product_id=product.id) }}" class="product-title-v3">{{ product.name }}</a>
                            <p class="product-author-v3">{{ product.author }}</p>
                            <div class="price-and-cart">
                                <div class="product-price-v3">
                                    <span class="current-price-v3">{{ "{:,.0f}".format(product.price) }} تومان</span>
                                </div>
                                <form action="{{ url_for('cart.add_to_cart', product_id=product.id) }}" method="POST">
                                    <button type="submit" class="add-to-cart-btn-v3">سبد خرید</button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                {% else %}
                <div class="col-12 text-center">
                    <p>محصولی برای نمایش وجود ندارد.</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

</main>

{% endblock %}